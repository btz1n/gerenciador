{% extends "base.html" %}
{% block content %}
<div class="grid two">
  <div class="card">
    <h3>White-label (Plano superior)</h3>
    <p class="muted">Deixe o sistema com a identidade da sua loja (nome, cores e logo). Se precisar de ajuda, fale direto com o suporte.</p>

    <form method="post" action="/settings/branding" class="form">
      <label>Nome do produto</label>
      <input name="product_name" value="{{ (branding.product_name if branding else 'IMPÉRIO') }}" required>

      <label>Cor primária</label>
      <input type="color" name="primary_color" value="{{ (branding.primary_color if branding else '#2f6bff') }}">

      <label>Cor secundária</label>
      <input type="color" name="secondary_color" value="{{ (branding.secondary_color if branding else '#9a7bff') }}">

      <div style="height:10px;"></div>
      <div class="h3" style="margin:0;">Temas prontos</div>
      <div class="muted" style="margin-top:4px;">Clique em um tema para aplicar automaticamente (cor primária + secundária). Você ainda pode ajustar depois.</div>

      <div class="theme-presets" style="margin-top:10px;">
        <button class="theme-card" type="button" data-primary="#2f6bff" data-secondary="#9a7bff">
          <span class="sw" style="background:#2f6bff"></span>
          <span class="sw" style="background:#9a7bff"></span>
          <span class="t">Império Azul</span>
        </button>

        <button class="theme-card" type="button" data-primary="#16a34a" data-secondary="#22c55e">
          <span class="sw" style="background:#16a34a"></span>
          <span class="sw" style="background:#22c55e"></span>
          <span class="t">Verde Market</span>
        </button>

        <button class="theme-card" type="button" data-primary="#f97316" data-secondary="#fb7185">
          <span class="sw" style="background:#f97316"></span>
          <span class="sw" style="background:#fb7185"></span>
          <span class="t">Laranja Bar</span>
        </button>

        <button class="theme-card" type="button" data-primary="#7c3aed" data-secondary="#a78bfa">
          <span class="sw" style="background:#7c3aed"></span>
          <span class="sw" style="background:#a78bfa"></span>
          <span class="t">Roxo Premium</span>
        </button>

        <button class="theme-card" type="button" data-primary="#0f172a" data-secondary="#334155">
          <span class="sw" style="background:#0f172a"></span>
          <span class="sw" style="background:#334155"></span>
          <span class="t">Noite Elegante</span>
        </button>
      </div>

      <div class="brand-preview" style="margin-top:12px;">
        <div class="muted">Prévia</div>
        <div class="brand-chip" id="brandPreview">
          <div class="logo-dot"></div>
          <div>
            <div class="bn" id="prevName">IMPÉRIO</div>
            <div class="bs">Seu sistema, sua marca</div>
          </div>
        </div>
      </div>


      <label>WhatsApp suporte</label>
      <input name="whatsapp_support" value="{{ (branding.whatsapp_support if branding and branding.whatsapp_support else '') }}" placeholder="22999480023">

      <button class="btn primary" type="submit">Salvar branding</button>
    </form>
  </div>

  <div class="card">
    <h3>Plano e Segmento</h3>
    <div class="kv"><div class="k">Segmento</div><div class="v"><b>{{ segment }}</b></div></div>
    <div class="kv"><div class="k">Plano</div><div class="v"><b>{{ plan }}</b></div></div>

    <div class="alert info">
      Para alterar plano/segmento e habilitar features, use o painel admin (master key) no backend (ou fale com o suporte).
    </div>

    <h4>Features atuais</h4>
    <div class="chips">
      {% for k,v in features.items() %}
        <span class="chip {{ 'on' if v else 'off' }}">{{ k }}: {{ 'on' if v else 'off' }}</span>
      {% endfor %}
    </div>
  </div>
</div>

<script>
(function(){
  const form = document.querySelector('form[action="/settings/branding"]');
  if(!form) return;

  const nameInput = form.querySelector('input[name="product_name"]');
  const pInput = form.querySelector('input[name="primary_color"]');
  const sInput = form.querySelector('input[name="secondary_color"]');
  const prev = document.getElementById("brandPreview");
  const prevName = document.getElementById("prevName");

  function applyPreview(){
    const p = pInput.value || "#2f6bff";
    const s = sInput.value || "#9a7bff";
    prev.style.borderColor = p;
    prev.style.background = `linear-gradient(135deg, ${p}22, ${s}22)`;
    prev.querySelector(".logo-dot").style.background = p;
    prev.querySelector(".bn").style.color = p;
    prevName.textContent = (nameInput.value || "IMPÉRIO").toUpperCase();
  }

  document.querySelectorAll(".theme-card").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      pInput.value = btn.dataset.primary;
      sInput.value = btn.dataset.secondary;
      applyPreview();
    });
  });

  nameInput.addEventListener("input", applyPreview);
  pInput.addEventListener("input", applyPreview);
  sInput.addEventListener("input", applyPreview);
  applyPreview();
})();
</script>

{% endblock %}

    <h3>Tipo de negócio</h3>
    <p class="muted">Escolha o perfil que melhor combina com sua operação. Você pode trocar quando quiser.</p>
    <form method="post" action="/settings/segment" class="form">
      <label>Segmento</label>
      <select class="input" name="segment">
        {% for seg,label in [('deposito','Loja / Depósito'),('delivery','Delivery'),('bar','Bar')] %}
          <option value="{{seg}}" {% if store and store.segment==seg %}selected{% endif %}>{{label}}</option>
        {% endfor %}
      </select>
      <button class="btn primary" style="margin-top:10px;">Salvar</button>
    </form>

    <div style="height:16px;"></div>
    <h3>Plano e assinatura</h3>
    <p class="muted">Para ativar ou renovar seu plano, fale com o suporte. Se você for o responsável pela loja, também pode ajustar o plano por aqui.</p>
    <form method="post" action="/settings/plan" class="form">
      <label>Plano</label>
      <select class="input" name="plan">
        {% for p,label in [('basic','Start'),('pro','Pro'),('elite','Elite')] %}
          <option value="{{p}}" {% if store and store.plan==p %}selected{% endif %}>{{label}}</option>
        {% endfor %}
      </select>
      <label>Status</label>
      <select class="input" name="subscription_status">
        {% for st in ['trial','active','past_due','suspended'] %}
          <option value="{{st}}" {% if store and store.subscription_status==st %}selected{% endif %}>{{st}}</option>
        {% endfor %}
      </select>
      <label>Válido até</label>
      <input class="input" type="date" name="paid_until" value="{{ (store.paid_until.date().isoformat() if store and store.paid_until else '') }}">
      <button class="btn primary" style="margin-top:10px;">Salvar</button>
    </form>
