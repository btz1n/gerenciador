{% extends "base.html" %}
{% block content %}
<div class="grid two">
  <div class="card">
    <h3>Identidade da sua loja</h3>
    <p class="muted">Personalize nome, cores e (no plano completo) a logo. Se precisar, fale com o suporte.</p>

    <form method="post" action="/settings/branding" class="form" enctype="multipart/form-data">
      <label>Nome do sistema</label>
      <input name="product_name" value="{{ (branding.product_name if branding else 'IMPÉRIO') }}" required {% if not features.get('white_label') %}disabled{% endif %}>

      <label>Cor primária</label>
      <input type="color" name="primary_color" value="{{ (branding.primary_color if branding else '#2f6bff') }}">

      <label>Cor secundária</label>
      <input type="color" name="secondary_color" value="{{ (branding.secondary_color if branding else '#9a7bff') }}">
{% if features.get("theme_custom") %}
    <label>Tema</label>
    <select name="theme_mode" class="input">
      <option value="dark" {% if branding and branding.theme_mode=="dark" %}selected{% endif %}>Escuro (Dark)</option>
      <option value="light" {% if branding and branding.theme_mode=="light" %}selected{% endif %}>Claro (Light)</option>
    </select>
    <label>Cor de fundo</label>
    <input class="input" type="color" name="bg_color" value="{{ branding.bg_color if branding and branding.bg_color else '#0b0f14' }}">
    <div class="muted" style="margin-top:6px">Dica: escolha um fundo mais claro se tiver dificuldade de visão.</div>
{% else %}
<div class="muted" style="margin-top:10px">Tema (claro/escuro e fundo) disponível no plano PRO ou ELITE.</div>
{% endif %}

      <label>WhatsApp do suporte (opcional)</label>
      <input name="whatsapp_support" value="{{ (branding.whatsapp_support if branding else '') }}" placeholder="Ex: 22999480023">

      <div style="height:10px;"></div>
      <div class="h3" style="margin:0;">Temas prontos</div>
      <div class="muted" style="margin-top:4px;">Clique em um tema para aplicar automaticamente (cor primária + secundária).</div>

      <div class="theme-presets" style="margin-top:10px;">
        <button class="theme-card" type="button" data-primary="#2f6bff" data-secondary="#9a7bff"><span class="dot" style="background:#2f6bff"></span>Império Azul</button>
        <button class="theme-card" type="button" data-primary="#16a34a" data-secondary="#22c55e"><span class="dot" style="background:#16a34a"></span>Verde Market</button>
        <button class="theme-card" type="button" data-primary="#f97316" data-secondary="#fb7185"><span class="dot" style="background:#f97316"></span>Laranja Bar</button>
        <button class="theme-card" type="button" data-primary="#7c3aed" data-secondary="#22d3ee"><span class="dot" style="background:#7c3aed"></span>Roxo Premium</button>
        <button class="theme-card" type="button" data-primary="#0f172a" data-secondary="#334155"><span class="dot" style="background:#0f172a"></span>Noite Elegante</button>
      </div>

      <div style="height:14px;"></div>

      <div class="h3" style="margin:0;">Logo</div>
      <div class="muted" style="margin-top:4px;">
        {% if features.get('white_label') %}
          Você pode trocar a logo no plano completo.
        {% else %}
          A troca de logo está disponível no plano completo. Para ativar, fale com o suporte.
        {% endif %}
      </div>

      <div class="row gap" style="margin-top:10px; align-items:center;">
        <div class="logo-preview">
          {% set _logo = '/static/img/imperio.png' %}
          {% if branding and branding.logo_url and features.get('white_label') %}
            {% set _logo = branding.logo_url %}
          {% endif %}
          <img src="{{ _logo }}" alt="Logo" />
        </div>
        <div style="flex:1;">
          <label class="label">Enviar imagem (PNG/JPG)</label>
          <input class="input" type="file" name="logo_file" accept="image/*" {% if not features.get('white_label') %}disabled{% endif %}>
          <div class="muted" style="margin-top:6px;">Dica: use uma imagem quadrada (ex: 500x500).</div>
        </div>
      </div>

      <div style="height:12px;"></div>
      <button class="btn" type="submit">
        Salvar
      </button>
    </form>
{% else %}
<div class="card" style="margin-top:12px">
  <div class="h3">Plano e assinatura</div>
  <div class="muted" style="margin-top:6px">Para ativar plano, renovar ou alterar assinatura, fale direto com o suporte.</div>
  <a class="btn primary" style="margin-top:10px" href="https://wa.me/{{ (branding.whatsapp_support or '')|replace('+','')|replace(' ','') }}">Falar com suporte</a>
</div>
{% endif %}
  </div>

  <div class="card">
    <h3>Plano e recursos</h3>
    <p class="muted">Veja o que está liberado para sua loja e altere plano/assinatura quando necessário.</p>

    <form method="post" action="/settings/plan" class="form">
      <label>Plano</label>
      <select name="plan">
        <option value="basic" {% if plan=='basic' %}selected{% endif %}>Start</option>
        <option value="pro" {% if plan=='pro' %}selected{% endif %}>Pro</option>
        <option value="elite" {% if plan=='elite' %}selected{% endif %}>Elite (Completo)</option>
      </select>

      <label>Status</label>
      <select name="subscription_status">
        <option value="trial" {% if store and store.subscription_status=='trial' %}selected{% endif %}>Teste</option>
        <option value="active" {% if store and store.subscription_status=='active' %}selected{% endif %}>Ativo</option>
        <option value="past_due" {% if store and store.subscription_status=='past_due' %}selected{% endif %}>Pagamento pendente</option>
        <option value="suspended" {% if store and store.subscription_status=='suspended' %}selected{% endif %}>Suspenso</option>
      </select>

      <label>Válido até (opcional)</label>
      <input type="date" name="paid_until" value="{{ (store.paid_until.date().isoformat() if store and store.paid_until else '') }}">

      <button class="btn" type="submit" style="margin-top:10px;">Salvar plano</button>
    </form>

    <div style="height:14px;"></div>
    <h4>Recursos liberados</h4>
    <div class="features-list">
      {% for key, meta in feature_meta.items() %}
        {% set enabled = features.get(key) %}
        <div class="feature-item {{ 'on' if enabled else 'off' }}">
          <div class="row between">
            <div>
              <div class="feature-title">{{ meta.label }}</div>
              <div class="muted">{{ meta.desc }}</div>
            </div>
            <div class="pill {{ 'on' if enabled else 'off' }}">{{ 'ATIVO' if enabled else 'BLOQUEADO' }}</div>
          </div>
        </div>
      {% endfor %}
    </div>

    <div class="alert info" style="margin-top:12px;">
      Quer ativar um plano, renovar ou tirar dúvidas? Fale direto com o suporte.
      {% if branding and branding.whatsapp_support %}
        <a class="link" href="https://wa.me/55{{ branding.whatsapp_support|replace(' ','')|replace('-','')|replace('(','')|replace(')','') }}" target="_blank">Chamar no WhatsApp</a>
      {% endif %}
    </div>
  </div>
</div>

<script>
(function(){
  const btns = document.querySelectorAll(".theme-card");
  const pri = document.querySelector('input[name="primary_color"]');
  const sec = document.querySelector('input[name="secondary_color"]');
  btns.forEach(b => b.addEventListener("click", ()=>{
    const p = b.getAttribute("data-primary");
    const s = b.getAttribute("data-secondary");
    if(pri) pri.value = p;
    if(sec) sec.value = s;
  }));
})();
</script>
{% endblock %}